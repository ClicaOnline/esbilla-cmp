<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Esbilla CMP - Test SDK</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #3D2B1F; }
    .test-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #FFBF00;
      border: 2px solid #3D2B1F;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover { background: #FFA500; }
    code {
      background: #eee;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    .info { color: #666; font-size: 14px; }
  </style>
</head>
<body>
  <h1>üåΩ Esbilla CMP - Test del SDK</h1>

  <div class="test-section">
    <h2>Estado Actual</h2>
    <p><strong>Footprint ID:</strong> <code id="footprint-display">Cargando...</code></p>
    <p><strong>Consentimiento guardado:</strong> <code id="consent-display">Ninguno</code></p>
  </div>

  <div class="test-section">
    <h2>Acciones de Prueba</h2>
    <button onclick="clearConsent()">üóëÔ∏è Borrar consentimiento</button>
    <button onclick="clearFootprint()">üîÑ Regenerar Footprint</button>
    <button onclick="location.reload()">‚ôªÔ∏è Recargar p√°gina</button>
  </div>

  <div class="test-section">
    <h2>Instrucciones</h2>
    <ol>
      <li>Al cargar la p√°gina, deber√≠a aparecer el banner de cookies</li>
      <li>Acepta o rechaza las cookies</li>
      <li>Deber√≠a aparecer "la mosca" con el Footprint ID (ej: <code>üç™ ESB-A7F3B2C1</code>)</li>
      <li>Haz clic en la mosca para volver a ver el banner</li>
    </ol>
    <p class="info">El Footprint ID se guarda en localStorage como <code>esbilla_footprint</code></p>
  </div>

  <div class="test-section">
    <h2>Verificar en Dashboard</h2>
    <p>Una vez aceptes/rechaces, busca tu Footprint ID en:</p>
    <p><a href="/dashboard/footprint" target="_blank">Dashboard ‚Üí Buscar Footprint</a></p>
  </div>

  <script>
    // Mostrar estado actual
    function updateDisplay() {
      const footprint = localStorage.getItem('esbilla_footprint') || 'No generado';
      const consent = localStorage.getItem('esbilla_consent');

      document.getElementById('footprint-display').textContent = footprint;
      document.getElementById('consent-display').textContent = consent || 'Ninguno';
    }

    function clearConsent() {
      localStorage.removeItem('esbilla_consent');
      alert('Consentimiento borrado. Recarga la p√°gina para ver el banner.');
      updateDisplay();
    }

    function clearFootprint() {
      localStorage.removeItem('esbilla_footprint');
      localStorage.removeItem('esbilla_consent');
      alert('Footprint y consentimiento borrados. Recarga la p√°gina.');
      updateDisplay();
    }

    // Actualizar display inicial
    updateDisplay();

    // Observar cambios en localStorage
    window.addEventListener('storage', updateDisplay);
    setInterval(updateDisplay, 1000);
  </script>

  <!-- Cargar el SDK de Esbilla -->
  <script src="/sdk.js" data-id="test-local"></script>
</body>
</html>
